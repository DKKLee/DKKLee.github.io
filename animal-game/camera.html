<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ‰‹æ©Ÿæ‹ç…§åˆæˆ</title>
  <link rel="preload" as="image" href="/overlay1.png">
  <link rel="preload" as="image" href="/overlay2.png">
  <link rel="preload" as="image" href="/overlay3.png">
  <style>
    body {
      font-family: Segoe UI, sans-serif;
      background: linear-gradient(120deg, #e0f7fa 0%, #f0f8ff 60%, #ffe0f7 100%);
      min-height: 100vh;
      text-align: center;
      margin: 0;
      padding: 1rem;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 0;
      background:
        radial-gradient(circle at 10% 20%, #b2ebf2 0px, transparent 120px),
        radial-gradient(circle at 80% 10%, #b3e5fc 0px, transparent 160px),
        radial-gradient(circle at 50% 80%, #81d4fa 0px, transparent 180px),
        radial-gradient(circle at 90% 70%, #e1bee7 0px, transparent 120px),
        radial-gradient(circle at 30% 60%, #fffde7 0px, transparent 100px),
        linear-gradient(120deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.0) 100%);
      opacity: 0.55;
      animation: bgGlow 6s ease-in-out infinite alternate;
    }

    @keyframes bgGlow {
      0% {
        opacity: 0.55;
      }

      100% {
        opacity: 0.75;
      }
    }

    .options-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }

    .options-container label {
      display: flex;
      align-items: center;
      padding: 5px 5px;
      border: 2px solid #ced4da;
      border-radius: 12px;
      background-color: #ffffff;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      font-size: 1.1em;
      color: #555;
      min-width: 50px;
      text-align: left;
    }

    .options-container label:hover {
      border-color: #8bbceb;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-3px);
    }

    .options-container input[type="radio"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
      pointer-events: none;
    }

    .options-container label::before {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid #999;
      margin-right: 5px;
      background-color: #fff;
      flex-shrink: 0;
      transition: all 0.3s ease;
    }

    .options-container input[type="radio"]:checked+label {
      background-color: #e0f2ff;
      border-color: #007bff;
      color: #0056b3;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .options-container input[type="radio"]:checked+label::before {
      background-color: #007bff;
      border-color: #007bff;
      box-shadow: inset 0 0 0 6px #ffffff;
    }

    .star {
      position: fixed;
      pointer-events: none;
      z-index: 1;
      border-radius: 50%;
      background: radial-gradient(circle, #fff 0%, #fff8 60%, transparent 100%);
      opacity: 0.7;
      animation: starTwinkle 2.5s infinite alternate, starFloat 12s linear infinite;
    }

    @keyframes starTwinkle {
      0% {
        opacity: 0.7;
        transform: scale(1) rotate(0deg);
      }

      100% {
        opacity: 1;
        transform: scale(1.3) rotate(20deg);
      }
    }

    @keyframes starFloat {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(-40px);
      }
    }

    .title-animate {
      animation: titleGlow 2.2s infinite alternate;
    }

    @keyframes titleGlow {
      0% {
        text-shadow: 0 2px 12px #fff8, 0 0 24px #b2ebf2;
        color: #4caf50;
      }

      100% {
        text-shadow: 0 4px 24px #fff, 0 0 36px #81d4fa;
        color: #388e3c;
      }
    }

    .result-animate {
      animation: resultPop 0.7s cubic-bezier(.4, 2, .3, 1);
    }

    @keyframes resultPop {
      0% {
        opacity: 0;
        transform: scale(0.7) translateY(-40px);
      }

      60% {
        opacity: 1;
        transform: scale(1.08) translateY(0);
      }

      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    #cameraWrap,
    #resultBtns,
    #resultImg,
    #canvas {
      position: relative;
      z-index: 1;
    }

    #cameraWrap {
      position: relative;
      display: inline-block;
    }

    #video {
      width: 90vw;
      max-width: 480px;
      height: auto;
      border-radius: 12px;
    }

    #overlayImg {
      position: absolute;
      right: 6px;
      bottom: 6px;
      left: auto;
      top: auto;
      width: auto;
      height: 240px;
      pointer-events: none;
    }

    #canvas {
      display: none;
      margin-top: 1rem;
      border-radius: 12px;
      max-width: 480px;
      max-height: 480px;
    }

    #btns {
      margin-top: 1.5rem;
    }

    button {
      padding: 0.7rem 1.5rem;
      font-size: 1.1rem;
      border-radius: 8px;
      border: none;
      background: #4caf50;
      color: #fff;
      margin: 0.5rem;
      cursor: pointer;
    }

    button:hover {
      background: #388e3c;
    }
  </style>
</head>

<body>
  <script>
    // å‹•æ…‹ç”Ÿæˆæ˜Ÿå…‰ç²’å­
    for (let i = 0; i < 18; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      const size = Math.random() * 8 + 6;
      star.style.width = size + 'px';
      star.style.height = size + 'px';
      star.style.left = (Math.random() * 100) + 'vw';
      star.style.top = (Math.random() * 100) + 'vh';
      star.style.animationDelay = (Math.random() * 2) + 's';
      document.body.appendChild(star);
    }
  </script>
  <h2 class="title-animate"
    style="letter-spacing:2px;font-weight:600;color:#4caf50;text-shadow:0 2px 12px #fff8,0 0 24px #b2ebf2;">æ‰‹æ©Ÿæ‹ç…§åˆæˆ</h2>
  <div class="options-container">
    <input type="radio" id="option1" name="choice" value="overlay1" checked>
    <label for="option1">
      åœ–ç‰‡ä¸€
    </label>

    <input type="radio" id="option2" name="choice" value="overlay2">
    <label for="option2">
      åœ–ç‰‡äºŒ
    </label>

    <input type="radio" id="option3" name="choice" value="overlay3">
    <label for="option3">
      åœ–ç‰‡ä¸‰
    </label>
  </div>
  <div id="cameraWrap" style="position:relative;">
    <video id="video" autoplay playsinline style="cursor:pointer;"></video>
    <img id="overlayImg" src="overlay1.png" alt="overlay" style="cursor:pointer;" />
    <div id="cameraTip"
      style="position:absolute;left:0;right:0;bottom:12px;color:#388e3c;font-size:1.2rem;background:rgba(255,255,255,0.7);padding:0.5rem 0;border-radius:8px;">
      é»æ“Šç•«é¢å¯æ‹ç…§</div>
  </div>
  <canvas id="canvas" width="400" height="400"></canvas>
  <div id="resultBtns" style="display:none;"></div>
  <script>
    const video = document.getElementById('video');
    const overlayImg = document.getElementById('overlayImg');
    const canvas = document.getElementById('canvas');
    const takePhotoBtn = document.getElementById('takePhotoBtn');
    const btns = document.getElementById('btns');
    const resultBtns = document.getElementById('resultBtns');
    const downloadBtn = document.getElementById('downloadBtn');
    const backBtn = document.getElementById('backBtn');
    const cameraTip = document.getElementById('cameraTip');

    // ç²å–æ‰€æœ‰åç¨±ç‚º 'choice' çš„ radio æŒ‰éˆ•
    const radioButtons = document.querySelectorAll('input[name="choice"]');

    // éæ­·æ¯å€‹ radio æŒ‰éˆ•ï¼Œä¸¦ç‚ºå…¶æ·»åŠ äº‹ä»¶ç›£è½å™¨
    radioButtons.forEach(radio => {
      radio.addEventListener('change', function () {
        // ç•¶ radio ç‹€æ…‹æ”¹è®Šï¼ˆè¢«é¸ä¸­ï¼‰æ™‚è§¸ç™¼æ­¤å‡½æ•¸
        if (this.checked) {
          // ç²å–è¢«é¸ä¸­é¸é …çš„æ–‡å­—å…§å®¹
          // é€™è£¡æˆ‘å€‘æ‰¾åˆ°å°æ‡‰çš„ labelï¼Œç„¶å¾Œç²å–å…¶ textContent
          const selectedLabel = document.querySelector(`label[for="${this.id}"]`);
          const optionText = selectedLabel ? selectedLabel.textContent.trim() : this.value;
          // overlayImg.src = `${this.value}.png`; // å‡è¨­åœ–ç‰‡åç¨±èˆ‡ value ç›¸åŒ
          requestAnimationFrame(() => {
            overlayImg.src = `${this.value}.png`;
          });

          // å½ˆå‡ºæç¤ºæ¡†
          alert(`æ‚¨é¸æ“‡äº†: ${optionText}`);
          startCamera(); // æ¯æ¬¡é¸æ“‡å¾Œé‡æ–°å•Ÿå‹•ç›¸æ©Ÿ
        }
      });
    });
    // é»æ“Šå³æ™‚å½±åƒæˆ–æ‡¸æµ®åœ–ç‰‡ä¹Ÿèƒ½æ‹ç…§
    function doTakePhoto() {
      // ä»¥ video å¯¬é«˜ç‚ºä¸»ï¼Œcanvas è·Ÿ video åŒæ¯”ä¾‹
      cameraTip.style.display = 'none';
      const vw = video.videoWidth || 480;
      const vh = video.videoHeight || 360;
      canvas.width = vw;
      canvas.height = vh;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, vw, vh);
      // å–å¾— overlayImg åœ¨ video ä¸Šçš„å¯¦éš›é¡¯ç¤ºå°ºå¯¸èˆ‡ä½ç½®
      const videoRect = video.getBoundingClientRect();
      const overlayRect = overlayImg.getBoundingClientRect();
      // è¨ˆç®— overlay åœ¨ canvas ä¸Šçš„åº§æ¨™èˆ‡å°ºå¯¸
      const scaleX = vw / videoRect.width;
      const scaleY = vh / videoRect.height;
      const ow = overlayRect.width * scaleX;
      const oh = overlayRect.height * scaleY;
      const ox = (overlayRect.left - videoRect.left) * scaleX;
      const oy = (overlayRect.top - videoRect.top) * scaleY;
      const imgObj = new Image();
      imgObj.src = overlayImg.src;
      imgObj.onload = function () {
        ctx.drawImage(imgObj, ox, oy, ow, oh);
        // ç”¢ç”Ÿ base64 åœ–ç‰‡
        const url = canvas.toDataURL('image/png');
        let resultImg = document.getElementById('resultImg');
        if (!resultImg) {
          resultImg = document.createElement('img');
          resultImg.id = 'resultImg';
          resultImg.style = 'width:90vw;max-width:480px;border-radius:12px;margin-top:1.5rem;display:block;object-fit:contain;';
          resultImg.alt = 'åˆæˆåœ–ç‰‡';
          // é¡¯ç¤ºåœ¨ resultBtns å€å¡Šä¸‹æ–¹
          if (resultBtns.nextSibling) {
            resultBtns.parentNode.insertBefore(resultImg, resultBtns.nextSibling);
          } else {
            resultBtns.parentNode.appendChild(resultImg);
          }
        }
        // æ¯æ¬¡æ‹ç…§éƒ½è¦†è“‹åœ–ç‰‡
        resultImg.src = url;
        resultImg.style.display = 'block';
        resultImg.classList.remove('result-animate');
        void resultImg.offsetWidth;
        resultImg.classList.add('result-animate');
        setTimeout(() => {
          // å¹³æ»‘æ»¾å‹•åˆ° resultImg
          resultImg.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 400);
        canvas.style.display = 'none';
        resultBtns.style.display = 'block';
        // é¡¯ç¤ºæç¤º
        let tip = document.getElementById('saveTip');
        if (!tip) {
          tip = document.createElement('div');
          tip.id = 'saveTip';
          tip.innerText = 'é•·æŒ‰åœ–ç‰‡å¯å„²å­˜åˆ°ç›¸ç°¿';
          tip.style = 'color:#388e3c;font-size:1.1rem;margin:0.5rem 0;';
          resultImg.parentNode.insertBefore(tip, resultImg.nextSibling);
        } else {
          tip.style.display = 'block';
        }
      };
    }
    video.onclick = doTakePhoto;
    overlayImg.onclick = doTakePhoto;

    // å•Ÿå‹•ç›¸æ©Ÿ
    // async function startCamera() {
    //   try {
    //     const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false });
    //     video.srcObject = stream;
    //   } catch (err) {
    //     alert('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼š' + err);
    //   }
    // }
    async function startCamera() {
      try {
        // ğŸ”» å¦‚æœå·²æœ‰ä¸²æµï¼Œå…ˆåœæ­¢
        if (video.srcObject) {
          const tracks = video.srcObject.getTracks();
          tracks.forEach(track => track.stop()); // åœæ­¢æ‰€æœ‰ video/audio tracks
          video.srcObject = null;
        }

        // ğŸ”º å†é–‹å•Ÿæ–°çš„ä¸²æµ
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' },
          audio: false
        });

        video.srcObject = stream;
      } catch (err) {
        alert('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼š' + err);
      }
    }
    startCamera();

    // æ‹ç…§åˆæˆ
    takePhotoBtn.onclick = function () {
      doTakePhoto();
    };

    // ä¸‹è¼‰åœ–ç‰‡
    downloadBtn.onclick = function () {
      // ä¸‹è¼‰ resultImg çš„åœ–ç‰‡
      const resultImg = document.getElementById('resultImg');
      if (resultImg && resultImg.src) {
        const a = document.createElement('a');
        a.href = resultImg.src;
        a.download = 'photo.png';
        a.click();
        setTimeout(() => {
          alert('åœ–ç‰‡å·²ä¸‹è¼‰ï¼Œè«‹åˆ°æ‰‹æ©Ÿä¸‹è¼‰è³‡æ–™å¤¾æˆ–ç›¸ç°¿æŸ¥çœ‹');
        }, 500);
      }
    };
    // å›ä¸»ç•«é¢
    backBtn.onclick = function () {
      // å·²ç§»é™¤ä¸»ç•«é¢åŠŸèƒ½ï¼Œé€™è£¡ä¸åšä»»ä½•äº‹
    };
  </script>
</body>

</html>